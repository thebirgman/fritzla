{%- liquid
  assign logo_count = section.blocks.size
-%}

{%- style -%}
  .logo-marquee-section-{{ section.id }} {
    position: relative;
    padding: 4rem 0;
    overflow: hidden;
    min-height: {{ section.settings.section_min_height | default: 200 }}px;
    border-radius: 24px 24px 0 0;
  }
  
  .logo-marquee-section-{{ section.id }} .logo-marquee__main-logo {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: 2;
    width: {{ section.settings.main_logo_width | default: 200 }}px;
    max-width: 100%;
    height: auto;
  }
  
  .logo-marquee-section-{{ section.id }} .logo-marquee__container {
    position: relative;
    width: 100%;
    min-height: {{ section.settings.section_min_height | default: 200 }}px;
    overflow: hidden;
  }
  
  .logo-marquee-section-{{ section.id }} .logo-marquee__wrapper {
    display: flex;
    width: fit-content;
  }
  
  .logo-marquee-section-{{ section.id }} .logo-marquee__track {
    display: flex;
    gap: {{ section.settings.desktop_gap | default: 4 }}rem;
    animation: logo-marquee-{{ section.id }} {{ section.settings.speed | default: 30 }}s linear infinite;
    will-change: transform;
  }
  
  .logo-marquee-section-{{ section.id }} .logo-marquee__wrapper:hover .logo-marquee__track {
    animation-play-state: paused;
  }
  
  .logo-marquee-section-{{ section.id }} .logo-marquee__item {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 80px;
    width: {{ section.settings.logo_width | default: 120 }}px;
  }
  
  .logo-marquee-section-{{ section.id }} .logo-marquee__item img {
    max-height: 80px;
    max-width: {{ section.settings.logo_width | default: 120 }}px;
    width: auto;
    height: auto;
    object-fit: contain;
    transition: opacity 0.3s ease, filter 0.3s ease;
  }
  .logo-marquee__main-logo {
    /* width: 160px; */
    /* height: 172px; */
}

  .logo-marquee-section-{{ section.id }} .logo-marquee__main-logo img {
    width: 100%;
    height: auto;
    object-fit: contain;
}

  .logo-marquee-section-{{ section.id }} .logo-marquee__container {
    display: flex;
    align-items: center;
}
  .logo-marquee-section-{{ section.id }} .logo-marquee__item:hover img {
    filter: grayscale(0%);
    opacity: 1;
  }
  
  @keyframes logo-marquee-{{ section.id }} {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-50%);
    }
  }
  
  /* Mobile styles */
  @media screen and (max-width: 749px) {
    .logo-marquee-section-{{ section.id }} {
      padding: 2rem 0;
    }
    
    .logo-marquee-section-{{ section.id }} {
      min-height: {{ section.settings.section_min_height | default: 200 | times: 0.6 | round: 0 }}px;
    }
    
    .logo-marquee-section-{{ section.id }} .logo-marquee__main-logo {
      position: relative;
      left: auto;
      top: auto;
      transform: none;
      margin: 0 auto 2rem;
      display: flex;
      width: {{ section.settings.main_logo_width | default: 200 | times: 0.75 | round: 0 }}px;
      max-width: 100%;
    }
    
    .logo-marquee-section-{{ section.id }} .logo-marquee__container {
      min-height: {{ section.settings.section_min_height | default: 200 | times: 0.6 | round: 0 }}px;
    }
    
    .logo-marquee-section-{{ section.id }} .logo-marquee__item {
      height: 60px;
      width: {{ section.settings.logo_width | default: 120 | times: 0.8 | round: 0 }}px;
    }
    
    .logo-marquee-section-{{ section.id }} .logo-marquee__item img {
      max-height: 60px;
      max-width: {{ section.settings.logo_width | default: 120 | times: 0.8 | round: 0 }}px;
    }
    
    .logo-marquee-section-{{ section.id }} .logo-marquee__track {
      gap: {{ section.settings.mobile_gap | default: 2 }}rem;
    }
  }
{%- endstyle -%}

<div class="logo-marquee-section-{{ section.id }} gradient color-{{ section.settings.color_scheme }}">
  <div class="logo-marquee-flex-container">
    {%- if section.settings.main_logo != blank -%}
      <div class="logo-marquee__main-logo">
        {{
          section.settings.main_logo
          | image_url: width: 400
          | image_tag: loading: 'lazy', alt: section.settings.main_logo.alt | default: 'Logo'
        }}
      </div>
    {%- endif -%}
    
    {%- if logo_count > 0 -%}
      <div class="logo-marquee__container">
        <div class="logo-marquee__wrapper">
          <div class="logo-marquee__track">
            {%- for block in section.blocks -%}
              {%- if block.settings.image != blank -%}
                <div class="logo-marquee__item" {{ block.shopify_attributes }}>
                  {{
                    block.settings.image
                    | image_url: width: 300
                    | image_tag: loading: 'lazy', alt: block.settings.image.alt | default: 'Logo'
                  }}
                </div>
              {%- endif -%}
            {%- endfor -%}
            <!-- Duplicate items for seamless infinite loop -->
            {%- for block in section.blocks -%}
              {%- if block.settings.image != blank -%}
                <div class="logo-marquee__item">
                  {{
                    block.settings.image
                    | image_url: width: 300
                    | image_tag: loading: 'lazy', alt: block.settings.image.alt | default: 'Logo'
                  }}
                </div>
              {%- endif -%}
            {%- endfor -%}
          </div>
        </div>
      </div>
    {%- endif -%}
  </div>
</div>

{% schema %}
{
  "name": "Logo Marquee",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "image_picker",
      "id": "main_logo",
      "label": "Main logo image"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "range",
      "id": "speed",
      "min": 10,
      "max": 60,
      "step": 1,
      "unit": "s",
      "label": "Speed of sliding logos",
      "default": 30,
      "info": "Speed in seconds for one complete cycle"
    },
    {
      "type": "range",
      "id": "logo_width",
      "min": 60,
      "max": 300,
      "step": 10,
      "unit": "px",
      "label": "Width of block images",
      "default": 120,
      "info": "Width of each logo image in pixels"
    },
    {
      "type": "range",
      "id": "main_logo_width",
      "min": 100,
      "max": 500,
      "step": 10,
      "unit": "px",
      "label": "Width of main logo image",
      "default": 200,
      "info": "Width of the main center logo in pixels"
    },
    {
      "type": "range",
      "id": "section_min_height",
      "min": 100,
      "max": 500,
      "step": 10,
      "unit": "px",
      "label": "Minimum height of section",
      "default": 200,
      "info": "Minimum height of the section in pixels"
    },
    {
      "type": "range",
      "id": "desktop_gap",
      "min": 1,
      "max": 10,
      "step": 0.5,
      "unit": "rem",
      "label": "Gap between logos (desktop)",
      "default": 4,
      "info": "Gap between each logo in rem units"
    },
    {
      "type": "range",
      "id": "mobile_gap",
      "min": 1,
      "max": 8,
      "step": 0.5,
      "unit": "rem",
      "label": "Gap between logos (mobile)",
      "default": 2,
      "info": "Gap between each logo in rem units"
    }
  ],
  "blocks": [
    {
      "type": "logo",
      "name": "Logo",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Logo image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Logo Marquee",
      "blocks": [
        {
          "type": "logo"
        },
        {
          "type": "logo"
        },
        {
          "type": "logo"
        },
        {
          "type": "logo"
        },
        {
          "type": "logo"
        }
      ]
    }
  ]
}
{% endschema %}

